!function(t){if(!("zip"in t))throw new Error("Book(): zip.js is a dependency of EPubBuilder.js");zip.useWebWorkers=!1;var e=function(){var t=[],e=function(){t.shift(),t.length>0&&t[0](e)};return t.push=function(t){Array.prototype.push.call(this,t),1===this.length&&this[0](e)},t},o=function(t){if(Object.keys(r.templates).length>0)return void t();var e=document.createElement("script");e.src=r.config.templateJS,e.type="text/javascript",document.body.appendChild(e),e.onload=t,e.onerror=function(){throw new Error("Book(): Template file could not be loaded correctly from path: "+r.config.templateJS)}},n=function(t){var e=this,o=new zip.fs.FS,n=o.root.addDirectory("META-INF"),a=o.root.addDirectory("OEBPS");e.book=a,o.root.addText("mimetype","application/epub+zip"),n.addBlob("container.xml",new Blob(['<?xml version="1.0"?><container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container"><rootfiles><rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/></rootfiles></container>'],{type:"application/xml"})),a.addBlob("title_page.xhtml",new Blob([r.templates.title_page({title:e.title,author:e.author})],{type:"application/xhtml+xml"})),a.addText("style.css",r.templates.style),e.book.chaptersAdded=1,e._zip=o,t()},a=function(t){for(var e=[],o=1;o<=this.book.chaptersAdded;o++)e.push(o);this.book.addBlob("content.opf",new Blob([r.templates.content({title:this.title,author:this.author,chapters:e,lang:this.language,uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,o="x"==t?e:3&e|8;return o.toString(16)})})],{type:"application/oebps-package+xml"})),t()};Handlebars.registerHelper("html",function(t){return new Handlebars.SafeString(t)});var r=function(){var t=this;if(!(t instanceof r))throw new Error("Book(): Function must be a new instance.");if("[object Object]"!==Object.prototype.toString.call(arguments[0]))throw new Error("Book(): First Argument must be an Object of Settings.");try{t.title=arguments[0].title,t.author=arguments[0].author}catch(a){}if("language"in arguments[0]){if(!/[a-z][a-z]-[A-Z][A-Z]/g.test(arguments[0].language))throw new Error("Book(): The language parameter must comply with RFC 3066 ex:en-US.");t.language=arguments[0].language}else t.language="en-US";t._queue=new e,t._queue.push(o),t._queue.push(n.bind(t))};r.prototype={exportBlob:function(t){var e=this;e._queue.push(a.bind(e)),e._queue.push(function(o){e._zip.root.exportBlob(function(e){t(e.slice(0,e.size,"application/epub+zip"))}),o()})},addChapter:function(t,e){var o=this,n=arguments,a=function(a){var i,l;if(2===n.length?(i=!isNaN(parseFloat(t))&&isFinite(t)?t:o.book.chaptersAdded,l=e.toString()):(l=t.toString(),i=o.book.chaptersAdded),l=r.templates.chapter({text:l,index:i}),r.config.validateXML&&(new DOMParser).parseFromString(l,"application/xhtml+xml").getElementsByTagName("parsererror").length>0)throw new Error("Book(): Invalid XHTML in chapter "+i);o.book.addBlob("chap"+i+".xhtml",new Blob([l],{type:"application/xhtml+xml"})),o.book.chaptersAdded++,a()};o._queue.push(a)},addChapters:function(t){for(var e=0;e<t.length;e++)this.addChapter(t[e])}},r.config={},r.templates={},r.config.templateJS="templates.js",r.config.templateCompile=["content","chapter","title_page"],r.config.validateXML=!0,Object.preventExtensions(r.config),t.Book=r}(this);